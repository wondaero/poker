<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <title></title>
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no" />
    <link rel="stylesheet" href="./assets/css/normalize.css">
    <style>
        .wrapper{width: 100%; max-width: 400px; margin: 0 auto; padding: 0 10px; box-sizing: border-box;}
        .btns{text-align: center;}
        .btns > button{
            width: 200px; height: 120px; font-size: 60px; outline: 0; border: 0; border-radius: 8px; display: inline-flex;
            align-items: center; justify-content: center;
        }
        button.hidden{display: none;}
        .board{
            display: flex; background: green; border: 5px solid brown; height: 100px; align-items: center; justify-content: center;
            margin-bottom: 10px;
        }
        .board > .cards{
            border-radius: 3px; box-shadow: 1px 1px 5px #000; width: 30px; height: 50px; background: #fff; margin-right: 5px; position: relative;
            font-size: 12px; display: flex; align-items: center; justify-content: center;
        }
        .board > .cards:last-child{margin-right: 0;}
        .top{position: absolute; top: 3px; left: 3px;}
        .bottom{position: absolute; bottom: 3px; right: 3px;}
        .pattern-color0, .pattern-color3{color: #000;}
        .pattern-color1, .pattern-color2{color: #f00;}
    </style>
</head>


<body>
    <div class="wrapper">
        <div id="board" class="board"></div>
        <div class="btns">
            <button id="btnStart" onclick="poker.start()">START</button>
            <button id="btnStop" class="hidden" onclick="poker.stop()">STOP</button>
        </div>
    </div>

    <script>
        // sdhc

        const qs = target => document.querySelector(target);
        const qsa = target => document.querySelectorAll(target);
        const splitTxt = (txt, idx) => txt.split('.')[idx];

        //tags
        const board = qs('#board');
        const btnStart = qs('#btnStart');
        const btnStop = qs('#btnStop');

        const cards = [
            '2.3', '3.3', '4.3', '5.3', '6.3', '7.3', '8.3', '9.3', '10.3', '11.3', '12.3', '13.3', '14.3',
            '2.2', '3.2', '4.2', '5.2', '6.2', '7.2', '8.2', '9.2', '10.2', '11.2', '12.2', '13.2', '14.2',
            '2.1', '3.1', '4.1', '5.1', '6.1', '7.1', '8.1', '9.1', '10.1', '11.1', '12.1', '13.1', '14.1',
            '2.0', '3.0', '4.0', '5.0', '6.0', '7.0', '8.0', '9.0', '10.0', '11.0', '12.0', '13.0', '14.0',
        ];

        const baseScore = {
            pair1: 20,
            pair2: 40,
            triple: 60,
            straight: 80,
            backStraight: 100,
            mountain: 120,
            flush: 140,
            fullHouse: 160,
            fourCard: 180,
            stiple: 200,
            backStiple: 220,
            rotiple: 240,
        }

        const patternArr = ['♠', '◆', '♥', '♣'];

        function getRandomNum(mn, mx){return Math.floor(Math.random() * (mx - mn + 1)) + mn;};
        function getRandomNum2(mn, mx, arr){
            const rdmNum = Math.floor(Math.random() * (mx - mn + 1)) + mn;
            let isSame = false;
            if(arr){
                for(let i = 0; i < arr.length; i++){
                    if(rdmNum == arr[i]){
                        isSame = true;
                        break;
                    }
                }
            }

            if(isSame) return getRandomNum2(mn, mx, arr);
            else return rdmNum;
        }

        const poker = new Poker();

        function Poker(){
            const t = this;

            t.init = function(){
                t.raf = '';
                t.pickedCards = [];
                board.innerHTML = '';
            };
            t.init();

            t.start = function(){
                btnStart.classList.add('hidden');
                btnStop.classList.remove('hidden');

                t.init();
                t.ing();
            }

            t.ing = function(){
                const rdmNumArr = [];
                for(let i = 0; i < 7; i++){
                    rdmNumArr.push(getRandomNum2(0, cards.length - 1, rdmNumArr));
                }
                board.innerHTML = '';

                t.pickedCards = [
                    cards[rdmNumArr[0]],
                    cards[rdmNumArr[1]],
                    cards[rdmNumArr[2]],
                    cards[rdmNumArr[3]],
                    cards[rdmNumArr[4]],
                    cards[rdmNumArr[5]],
                    cards[rdmNumArr[6]],
                ];

                t.setUI(t.pickedCards);

                t.raf = requestAnimationFrame(t.ing);
            }

            t.stop = function(){
                window.cancelAnimationFrame(t.raf);
                btnStart.classList.remove('hidden');
                btnStop.classList.add('hidden');
                t.analize();
            }

            t.setUI = function(arr){
                arr.forEach(function(el){
                    let changedNum = splitTxt(el, 0);
                    switch(changedNum){
                        case '11': changedNum = 'J'; break;
                        case '12': changedNum = 'Q'; break;
                        case '13': changedNum = 'K'; break;
                        case '14': changedNum = 'A'; break;
                    }

                    const card = document.createElement('div');
                    card.classList.add('cards');
                    card.classList.add('pattern-color' + splitTxt(el, 1));


                    card.innerHTML = `
                        <div class="top">${changedNum}</div>
                        <div class="pattern">${patternArr[splitTxt(el, 1)]}</div>
                        <div class="bottom">${changedNum}</div>
                    `;

                    board.append(card);
                })
            }

            t.analize = function(){
                // console.log(t.pickedCards);

                const patterned = t.pickedCards.sort((a, b) => +splitTxt(a, 1) - +splitTxt(b, 1));
                const orderedNum = t.pickedCards.sort((a, b) => +splitTxt(a, 0) - +splitTxt(b, 0));

                // console.log(patterned);
                console.log(orderedNum);

                const overlapNum = {};  //페어처리
                const samePattern = {};

                let isPair = false;
                let isflush = false;
                let isFourCard = false;
                let isTriple = false;
                let isFullHouse = false;

                let finalScore = 0;
                let score1 = 0; //숫자
                let score2 = 0; //모양


                let straightChk = 0;
                const straightArr = [];
                for(let i = 0; i < orderedNum.length; i++){
                    if(i == orderedNum.length - 1){
                        break;
                    }
                    
                    if(+splitTxt(orderedNum[i], 0) == (+splitTxt(orderedNum[i + 1], 0) - 1)){
                        straightChk++;
                        straightArr.push(orderedNum[i]);
                    } else if(splitTxt(orderedNum[i], 0) != +splitTxt(orderedNum[i + 1], 0) && splitTxt(orderedNum[i], 0) != (+splitTxt(orderedNum[i + 1], 0) - 1)){
                        straightChk = 0;
                        straightArr.length = 0;
                    }

                }



                t.pickedCards.forEach(function(card){
                    const num = +splitTxt(card, 0);
                    const patternNum = +splitTxt(card, 1);

                    //페어처리
                    if(overlapNum[num]){
                        overlapNum[num]++;
                        isPair = true;
                        if(overlapNum[num] > 2 && !isTriple) isTriple = true;
                        if(overlapNum[num] > 3) {
                            score1 = num;
                            isFourCard = true;
                        }
                    }else{
                        overlapNum[num] = 1
                    }

                    //플러쉬
                    if(samePattern[patternNum]){
                        samePattern[patternNum]++;
                        if(samePattern[patternNum] > 4) isflush = true;
                    }else{
                        samePattern[patternNum] = 1;
                    }
                });

                // console.log(overlapNum);
                // console.log(samePattern);

                if(isFourCard){
                    finalScore = baseScore.fourCard + +score1;
                    t.result('포카드');
                    return;
                }
                if(isTriple){
                    for(let key in overlapNum){
                        // if(overlapNum[key] !== 3 && overlapNum[key] > 1){
                        if(overlapNum[key] === 3){
                            score1 = key;
                        }else{
                            if(overlapNum[key] > 1){
                                isFullHouse = true;
                            }
                        }
                    }
                }
                if(isFullHouse){
                    finalScore = baseScore.fullhouse + +score1;
                    t.result('풀하우스');
                    return;
                }
                if(isflush){ //플러쉬
                    console.log('플러쉬!');
                }

                if(straightChk === 4){
                    console.log('스트레이트');
                }

                if(isPair){ //원페어 이상
                    console.log('원페어 이상!');
                }else{  //탑

                }

                
            }

            t.result = function(dd){
                alert(dd);
            }
        }

        


    </script>
</body>

</html>